# Report Endpoints Documentation

paths:
  /projects/{id}/reports:
    get:
      tags:
        - Reports
      summary: List project reports
      description: |
        List generated reports for a project with pagination and filtering.
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectIdParam'
        - $ref: '#/components/parameters/pageParam'
        - $ref: '#/components/parameters/limitParam'
        - name: sortBy
          in: query
          description: Field to sort by
          schema:
            type: string
            enum: [requested_at, generated_at, name, status]
            default: requested_at
        - $ref: '#/components/parameters/sortOrderParam'
        - $ref: '#/components/parameters/searchParam'
        - name: status
          in: query
          description: Filter by report status
          schema:
            $ref: '#/components/schemas/ReportStatus'
        - name: format
          in: query
          description: Filter by report format
          schema:
            $ref: '#/components/schemas/ReportFormat'
        - name: analysisId
          in: query
          description: Filter by analysis UUID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Reports retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      allOf:
                        - $ref: '#/components/schemas/Report'
                        - type: object
                          properties:
                            analysisName:
                              type: string
                            projectName:
                              type: string
                            requestedByName:
                              type: string
                            requestedByEmail:
                              type: string
                              format: email
                  meta:
                    $ref: '#/components/schemas/PaginationMeta'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'

    post:
      tags:
        - Reports
      summary: Request report generation
      description: |
        Request generation of a report for a HazOps analysis. Report generation
        is asynchronous - this endpoint returns immediately with a job ID.
        Use GET /reports/{id}/status to check progress.

        Available formats:
        - **pdf**: Professional PDF document
        - **word**: Microsoft Word (docx) for editing
        - **excel**: Spreadsheet with analysis data tables
        - **powerpoint**: Presentation slides with key findings
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - analysisId
                - format
                - template
              properties:
                analysisId:
                  type: string
                  format: uuid
                  description: Analysis to generate report for
                format:
                  $ref: '#/components/schemas/ReportFormat'
                template:
                  type: string
                  description: Template identifier
                  example: standard-hazops
                name:
                  type: string
                  description: Custom report name
                  example: Feed Section HazOps Report
                parameters:
                  type: object
                  description: Additional generation parameters
                  properties:
                    includeRiskMatrix:
                      type: boolean
                      description: Include 5x5 risk matrix visualization
                      default: true
                    includeCompliance:
                      type: boolean
                      description: Include compliance summary
                      default: true
                    includeLopa:
                      type: boolean
                      description: Include LOPA analysis results
                      default: true
                    includeRecommendations:
                      type: boolean
                      description: Include recommendations summary
                      default: true
                    riskLevelFilter:
                      type: array
                      items:
                        $ref: '#/components/schemas/RiskLevel'
                      description: Only include entries with these risk levels
      responses:
        '202':
          description: Report generation started
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                        description: Report job ID
                      status:
                        $ref: '#/components/schemas/ReportStatus'
                      statusUrl:
                        type: string
                        format: uri
                        description: URL to check report status
                        example: /reports/123e4567-e89b-12d3-a456-426614174000/status
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'

  /reports/{id}/status:
    get:
      tags:
        - Reports
      summary: Get report generation status
      description: |
        Check the status of a report generation job. Poll this endpoint
        until status is 'completed' or 'failed'.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Report UUID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Report status retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                      status:
                        $ref: '#/components/schemas/ReportStatus'
                      progress:
                        type: integer
                        description: Progress percentage (0-100)
                        example: 75
                      requestedAt:
                        type: string
                        format: date-time
                      generatedAt:
                        type: string
                        format: date-time
                        nullable: true
                      downloadUrl:
                        type: string
                        format: uri
                        description: Available when status is 'completed'
                        nullable: true
                      errorMessage:
                        type: string
                        description: Error details when status is 'failed'
                        nullable: true
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'

  /reports/{id}/download:
    get:
      tags:
        - Reports
      summary: Download generated report
      description: |
        Get a signed URL to download the generated report.
        The URL is valid for 1 hour.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Report UUID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Download URL generated
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      url:
                        type: string
                        format: uri
                        description: Signed download URL
                      filename:
                        type: string
                        description: Suggested filename
                        example: Feed_Section_HazOps_Report.pdf
                      mimeType:
                        type: string
                        description: Content type
                        example: application/pdf
                      fileSize:
                        type: integer
                        description: File size in bytes
                      expiresAt:
                        type: string
                        format: date-time
                        description: URL expiration time
        '400':
          description: Report not ready for download
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: VALIDATION_ERROR
                  message: Report generation is not complete
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'

  /templates:
    get:
      tags:
        - Reports
      summary: List report templates
      description: |
        List available report templates. Templates define the structure and
        content of generated reports.
      security:
        - bearerAuth: []
      parameters:
        - name: format
          in: query
          description: Filter by supported format
          schema:
            $ref: '#/components/schemas/ReportFormat'
      responses:
        '200':
          description: Templates retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/ReportTemplate'
                    example:
                      - id: standard-hazops
                        name: Standard HazOps Report
                        description: Comprehensive HazOps report with all analysis details
                        supportedFormats: [pdf, word, excel]
                        isDefault: true
                      - id: executive-summary
                        name: Executive Summary
                        description: High-level summary focusing on key findings and recommendations
                        supportedFormats: [pdf, word, powerpoint]
                        isDefault: false
                      - id: risk-register
                        name: Risk Register
                        description: Tabular format optimized for risk tracking
                        supportedFormats: [excel]
                        isDefault: false
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalError'
